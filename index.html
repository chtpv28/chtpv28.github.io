<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ü–µ–Ω–∫–∏ —Å–µ–ø—Å–∏—Å–∞ –≤ –∞–∫—É—à–µ—Ä—Å—Ç–≤–µ</title>
    <meta name="description" content="–û–Ω–ª–∞–π–Ω-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞ —Å–µ–ø—Å–∏—Å–∞ —É –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Ä–æ–¥–∏–ª—å–Ω–∏—Ü">
    <meta name="theme-color" content="#2196F3">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü©∫</text></svg>">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #2196F3;
            --primary-dark: #1976D2;
            --danger: #f44336;
            --warning: #ff9800;
            --success: #4CAF50;
            --gray: #f5f5f5;
            --border: #ddd;
            --text: #333;
            --card-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 24px 32px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            padding: 24px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section, .results-section {
            background: var(--gray);
            border-radius: 12px;
            padding: 24px;
        }
        
        h2 {
            color: var(--primary-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border);
            font-size: 22px;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 14px;
            color: #555;
        }
        
        input, select {
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        .critical {
            border-color: var(--danger) !important;
            background-color: rgba(244, 67, 54, 0.05);
        }
        
        .warning {
            border-color: var(--warning) !important;
            background-color: rgba(255, 152, 0, 0.05);
        }
        
        .normal {
            border-color: var(--success) !important;
        }
        
        .unit {
            font-size: 12px;
            color: #777;
            margin-top: 4px;
        }
        
        .scale-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        
        .scale-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            border-top: 4px solid var(--primary);
            transition: transform 0.3s;
        }
        
        .scale-card:hover {
            transform: translateY(-4px);
        }
        
        .scale-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .scale-name {
            font-weight: 600;
            font-size: 18px;
            color: var(--primary-dark);
        }
        
        .score-container {
            text-align: right;
        }
        
        .score {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            line-height: 1;
        }
        
        .params-count {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
        
        .risk-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 8px;
        }
        
        .low-risk {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--success);
        }
        
        .high-risk {
            background-color: rgba(244, 67, 54, 0.2);
            color: var(--danger);
        }
        
        .medium-risk {
            background-color: rgba(255, 152, 0, 0.2);
            color: var(--warning);
        }
        
        .interpretation {
            margin-top: 12px;
            font-size: 14px;
            line-height: 1.5;
            color: #555;
        }
        
        .pwa-banner {
            background: var(--primary);
            color: white;
            padding: 12px 24px;
            text-align: center;
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        
        .pwa-banner button {
            background: white;
            color: var(--primary);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            margin-left: 12px;
            cursor: pointer;
            font-weight: 600;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            font-size: 14px;
            color: #666;
            border-top: 1px solid var(--border);
        }
        
        .reset-btn {
            background: var(--warning);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            width: 100%;
            transition: background 0.3s;
        }
        
        .reset-btn:hover {
            background: #e68900;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü©∫ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ü–µ–Ω–∫–∏ —Å–µ–ø—Å–∏—Å–∞ –≤ –∞–∫—É—à–µ—Ä—Å—Ç–≤–µ</h1>
            <p class="subtitle">–ï–¥–∏–Ω—ã–π –≤–≤–æ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø–æ –≤—Å–µ–º —à–∫–∞–ª–∞–º</p>
        </header>
        
        <div class="main-content">
            <section class="input-section">
                <h2>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞—Ü–∏–µ–Ω—Ç–∞</h2>
                <div class="input-grid" id="inputFields">
                    <!-- –ü–æ–ª—è –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã JavaScript -->
                </div>
                <button class="reset-btn" onclick="resetAll()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è</button>
            </section>
            
            <section class="results-section">
                <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞</h2>
                <div class="scale-cards" id="scaleCards">
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —à–∫–∞–ª –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã JavaScript -->
                </div>
            </section>
        </div>
        
        <footer>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ä–∏—Å–∫–∞ —Å–µ–ø—Å–∏—Å–∞ —É –±–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Ä–æ–¥–∏–ª—å–Ω–∏—Ü. –í—Å–µ —Ä–∞—Å—á—ë—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.</p>
            <p>–î–ª—è —Ç–æ—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É.</p>
        </footer>
    </div>
    
    <div class="pwa-banner" id="pwaBanner">
        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
        <button onclick="installPWA()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
        <button onclick="dismissBanner()">–ü–æ–∑–∂–µ</button>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
        const parameters = [
            { id: 'temp', label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ç–µ–ª–∞', unit: '¬∞C', type: 'number', step: '0.1', min: '20', max: '45' },
            { id: 'hr', label: '–ß–°–°', unit: '—É–¥/–º–∏–Ω', type: 'number', min: '0', max: '300' },
            { id: 'rr', label: '–ß–î', unit: '/–º–∏–Ω', type: 'number', min: '0', max: '100' },
            { id: 'sbp', label: '–ê–î —Å–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ', unit: '–º–º —Ä—Ç.—Å—Ç.', type: 'number', min: '0', max: '300' },
            { id: 'dbp', label: '–ê–î –¥–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ', unit: '–º–º —Ä—Ç.—Å—Ç.', type: 'number', min: '0', max: '200' },
            { id: 'spo2', label: 'SpO‚ÇÇ', unit: '%', type: 'number', min: '0', max: '100' },
            { id: 'wbc', label: '–õ–µ–π–∫–æ—Ü–∏—Ç—ã', unit: '√ó10‚Åπ/–ª', type: 'number', step: '0.1', min: '0', max: '100' },
            { id: 'bands', label: '–Æ–Ω—ã–µ –Ω–µ–π—Ç—Ä–æ—Ñ–∏–ª—ã', unit: '%', type: 'number', min: '0', max: '100' },
            { id: 'lactate', label: '–õ–∞–∫—Ç–∞—Ç', unit: '–º–º–æ–ª—å/–ª', type: 'number', step: '0.1', min: '0', max: '20' },
            { id: 'gcs', label: '–®–ö–ì (GCS)', unit: '–±–∞–ª–ª', type: 'number', min: '3', max: '15' },
            { 
                id: 'mental', 
                label: '–ú–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å', 
                type: 'select', 
                options: [
                    { value: 'alert', label: 'Alert (–≤ —Å–æ–∑–Ω–∞–Ω–∏–∏)' },
                    { value: 'not_alert', label: 'Not Alert (–Ω–∞—Ä—É—à–µ–Ω–æ)' }
                ] 
            },
            { 
                id: 'o2_therapy', 
                label: '–ö–∏—Å–ª–æ—Ä–æ–¥–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è', 
                type: 'select', 
                options: [
                    { value: 'air', label: '–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–π –≤–æ–∑–¥—É—Ö' },
                    { value: 'nasal', label: '–ù–æ—Å–æ–≤–æ–π –∫–∞—Ç–µ—Ç–µ—Ä' },
                    { value: 'mask', label: '–ú–∞—Å–∫–∞ –∏–ª–∏ –±–æ–ª—å—à–µ' }
                ] 
            },
            { 
                id: 'pph', 
                label: '–¢—è–∂—ë–ª–æ–µ –ü–ü–ö/—Ä–∏—Å–∫ –°–°–ó', 
                type: 'select', 
                options: [
                    { value: 'no', label: '–ù–µ—Ç' },
                    { value: 'yes', label: '–î–∞' }
                ] 
            }
        ];

        // –®–∫–∞–ª—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
        const scales = [
            { 
                id: 'sirs', 
                name: 'SIRS', 
                maxScore: 4, 
                totalParams: 4, // –í—Å–µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ —à–∫–∞–ª–µ
                calculate: calculateSIRS 
            },
            { 
                id: 'omqsofa', 
                name: 'omqSOFA', 
                maxScore: 3, 
                totalParams: 3,
                calculate: calculateOmqSOFA 
            },
            { 
                id: 'moews', 
                name: 'MOEWS', 
                maxScore: 24, 
                totalParams: 9, // 9 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ MOEWS
                calculate: calculateMOEWS 
            },
            { 
                id: 'sos', 
                name: 'SOS', 
                maxScore: 24, 
                totalParams: 8, // 8 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ SOS
                calculate: calculateSOS 
            },
            { 
                id: 'qsofa', 
                name: 'qSOFA', 
                maxScore: 3, 
                totalParams: 3,
                calculate: calculateQSOFA 
            }
        ];

        let deferredPrompt;
        const pwaBanner = document.getElementById('pwaBanner');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            generateInputFields();
            generateScaleCards();
            updateAllCalculations();
            setupPWA();
        });

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
        function generateInputFields() {
            const container = document.getElementById('inputFields');
            parameters.forEach(param => {
                const div = document.createElement('div');
                div.className = 'input-group';
                
                const label = document.createElement('label');
                label.textContent = param.label;
                label.htmlFor = param.id;
                
                div.appendChild(label);
                
                if (param.type === 'select') {
                    const select = document.createElement('select');
                    select.id = param.id;
                    param.options.forEach(opt => {
                        const option = document.createElement('option');
                        option.value = opt.value;
                        option.textContent = opt.label;
                        select.appendChild(option);
                    });
                    select.addEventListener('change', updateAllCalculations);
                    div.appendChild(select);
                } else {
                    const input = document.createElement('input');
                    input.type = param.type;
                    input.id = param.id;
                    input.step = param.step || '1';
                    input.min = param.min || '0';
                    if (param.max) input.max = param.max;
                    input.addEventListener('input', updateAllCalculations);
                    div.appendChild(input);
                }
                
                if (param.unit) {
                    const unit = document.createElement('div');
                    unit.className = 'unit';
                    unit.textContent = param.unit;
                    div.appendChild(unit);
                }
                
                container.appendChild(div);
            });
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ —à–∫–∞–ª
        function generateScaleCards() {
            const container = document.getElementById('scaleCards');
            scales.forEach(scale => {
                const card = document.createElement('div');
                card.className = 'scale-card';
                card.id = `card-${scale.id}`;
                
                card.innerHTML = `
                    <div class="scale-header">
                        <div class="scale-name">${scale.name}</div>
                        <div class="score-container">
                            <div class="score" id="score-${scale.id}">0</div>
                            <div class="params-count" id="params-${scale.id}">0/${scale.totalParams}</div>
                        </div>
                    </div>
                    <div class="risk-indicator" id="risk-${scale.id}">–ù–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ</div>
                    <div class="interpretation" id="interpretation-${scale.id}">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞</div>
                `;
                
                container.appendChild(card);
            });
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–∞—Å—á—ë—Ç–æ–≤
        function updateAllCalculations() {
            const values = getInputValues();
            updateInputStyles(values);
            
            scales.forEach(scale => {
                const result = scale.calculate(values);
                updateScaleCard(scale.id, result);
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
        function getInputValues() {
            const values = {};
            parameters.forEach(param => {
                const element = document.getElementById(param.id);
                if (param.type === 'select') {
                    values[param.id] = element.value;
                } else {
                    const val = parseFloat(element.value);
                    values[param.id] = isNaN(val) ? null : val;
                }
            });
            return values;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
        function updateInputStyles(values) {
            parameters.forEach(param => {
                if (param.type === 'number') {
                    const element = document.getElementById(param.id);
                    const value = values[param.id];
                    
                    // –°–±—Ä–æ—Å –∫–ª–∞—Å—Å–æ–≤
                    element.classList.remove('critical', 'warning', 'normal');
                    
                    if (value !== null) {
                        // –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∏–∫–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
                        if (param.id === 'temp') {
                            if (value > 38.5 || value < 36) element.classList.add('critical');
                            else if (value > 37.5 || value < 36.5) element.classList.add('warning');
                            else element.classList.add('normal');
                        } else if (param.id === 'hr') {
                            if (value > 130 || value < 50) element.classList.add('critical');
                            else if (value > 100 || value < 60) element.classList.add('warning');
                            else element.classList.add('normal');
                        } else if (param.id === 'sbp') {
                            if (value < 90 || value > 160) element.classList.add('critical');
                            else if (value < 100 || value > 140) element.classList.add('warning');
                            else element.classList.add('normal');
                        } else if (param.id === 'rr') {
                            if (value > 25 || value < 10) element.classList.add('critical');
                            else if (value > 20 || value < 12) element.classList.add('warning');
                            else element.classList.add('normal');
                        }
                    }
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —à–∫–∞–ª—ã
        function updateScaleCard(scaleId, result) {
            document.getElementById(`score-${scaleId}`).textContent = result.score;
            document.getElementById(`params-${scaleId}`).textContent = `${result.usedParams}/${result.totalParams}`;
            
            const riskElement = document.getElementById(`risk-${scaleId}`);
            riskElement.textContent = result.risk;
            riskElement.className = 'risk-indicator ' + result.riskClass;
            
            document.getElementById(`interpretation-${scaleId}`).textContent = result.interpretation;
        }

        // –§—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á—ë—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —à–∫–∞–ª—ã
        function calculateSIRS(values) {
            let score = 0;
            let usedParams = 0;
            
            if (values.temp !== null) {
                usedParams++;
                if (values.temp > 38 || values.temp < 36) score++;
            }
            if (values.hr !== null) {
                usedParams++;
                if (values.hr > 90) score++;
            }
            if (values.rr !== null) {
                usedParams++;
                if (values.rr > 20) score++;
            }
            if (values.wbc !== null) {
                usedParams++;
                if (values.wbc > 12 || values.wbc < 4) score++;
            }
            
            const risk = score >= 2 ? '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫' : '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫';
            const riskClass = score >= 2 ? 'high-risk' : 'low-risk';
            const interpretation = score >= 2 
                ? '–ü–∞—Ü–∏–µ–Ω—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏—è–º SIRS'
                : '–ü–∞—Ü–∏–µ–Ω—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏—è–º SIRS';
                
            return { 
                score, 
                usedParams, 
                totalParams: 4, 
                risk, 
                riskClass, 
                interpretation 
            };
        }

        function calculateOmqSOFA(values) {
            let score = 0;
            let usedParams = 0;
            
            if (values.sbp !== null) {
                usedParams++;
                if (values.sbp < 90) score++;
            }
            if (values.rr !== null) {
                usedParams++;
                if (values.rr > 25) score++;
            }
            if (values.mental) {
                usedParams++;
                if (values.mental === 'not_alert') score++;
            }
            
            const risk = score >= 2 ? '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫' : '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫';
            const riskClass = score >= 2 ? 'high-risk' : 'low-risk';
            const interpretation = score >= 2 
                ? '–ü–æ–∫–∞–∑–∞–Ω–∞ –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤ –û–†–ò–¢'
                : '–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ';
                
            return { 
                score, 
                usedParams, 
                totalParams: 3, 
                risk, 
                riskClass, 
                interpretation 
            };
        }

        function calculateMOEWS(values) {
            let score = 0;
            let usedParams = 0;
            
            // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
            if (values.temp !== null) {
                usedParams++;
                if (values.temp >= 39 || values.temp <= 35) score += 3;
                else if (values.temp >= 38.1 && values.temp <= 38.9) score += 2;
                else if ((values.temp >= 35.1 && values.temp <= 35.9) || 
                         (values.temp >= 37.5 && values.temp <= 38)) score += 1;
            }
            
            // –ß–î
            if (values.rr !== null) {
                usedParams++;
                if (values.rr >= 30 || values.rr < 10) score += 3;
                else if (values.rr >= 21 && values.rr <= 29) score += 2;
                else if (values.rr >= 10 && values.rr <= 11) score += 1;
            }
            
            // SpO2
            if (values.spo2 !== null) {
                usedParams++;
                if (values.spo2 <= 90) score += 3;
                else if (values.spo2 >= 91 && values.spo2 <= 93) score += 2;
                else if (values.spo2 >= 94 && values.spo2 <= 95) score += 1;
            }
            
            // –ö–∏—Å–ª–æ—Ä–æ–¥–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è
            if (values.o2_therapy) {
                usedParams++;
                if (values.o2_therapy === 'mask') score += 3;
                else if (values.o2_therapy === 'nasal') score += 2;
            }
            
            // –ß–°–°
            if (values.hr !== null) {
                usedParams++;
                if (values.hr < 50 || values.hr >= 130) score += 3;
                else if ((values.hr >= 50 && values.hr <= 59) || 
                         (values.hr >= 110 && values.hr <= 129)) score += 2;
                else if (values.hr >= 100 && values.hr <= 109) score += 1;
            }
            
            // –ê–î —Å–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ
            if (values.sbp !== null) {
                usedParams++;
                if (values.sbp < 90 || values.sbp >= 160) score += 3;
                else if (values.sbp >= 150 && values.sbp <= 159) score += 2;
                else if ((values.sbp >= 90 && values.sbp <= 99) || 
                         (values.sbp >= 140 && values.sbp <= 149)) score += 1;
            }
            
            // –ê–î –¥–∏–∞—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ
            if (values.dbp !== null) {
                usedParams++;
                if (values.dbp >= 110) score += 3;
                else if (values.dbp >= 100 && values.dbp <= 109) score += 2;
                else if (values.dbp <= 45 || 
                         (values.dbp >= 90 && values.dbp <= 99)) score += 1;
            }
            
            // –ú–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            if (values.mental) {
                usedParams++;
                if (values.mental === 'not_alert') score += 3;
            }
            
            // –ü–ü–ö/—Ä–∏—Å–∫ –°–°–ó
            if (values.pph) {
                usedParams++;
                if (values.pph === 'yes') score += 3;
            }
            
            let risk, riskClass, interpretation;
            if (score <= 2) {
                risk = '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫';
                riskClass = 'low-risk';
                interpretation = '–¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω –ª–µ—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è';
            } else if (score <= 4) {
                risk = '–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫';
                riskClass = 'medium-risk';
                interpretation = '–ù–∞–±–ª—é–¥–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è';
            } else {
                risk = '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫';
                riskClass = 'high-risk';
                interpretation = '–ü–æ–∫–∞–∑–∞–Ω–∞ –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤ –û–†–ò–¢';
            }
            
            return { 
                score, 
                usedParams, 
                totalParams: 9, 
                risk, 
                riskClass, 
                interpretation 
            };
        }

        function calculateSOS(values) {
            let score = 0;
            let usedParams = 0;
            
            // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
            if (values.temp !== null) {
                usedParams++;
                if (values.temp > 40.9 || values.temp < 30) score += 4;
                else if ((values.temp >= 39 && values.temp <= 40.9) || 
                         (values.temp >= 30 && values.temp <= 31.9)) score += 3;
                else if (values.temp >= 32 && values.temp <= 33.9) score += 2;
                else if ((values.temp >= 38.5 && values.temp <= 38.9) || 
                         (values.temp >= 34 && values.temp <= 35.9)) score += 1;
            }
            
            // –ß–°–°
            if (values.hr !== null) {
                usedParams++;
                if (values.hr > 179) score += 4;
                else if (values.hr >= 150 && values.hr <= 179) score += 3;
                else if (values.hr >= 130 && values.hr <= 149) score += 2;
                else if (values.hr >= 120 && values.hr <= 129) score += 1;
            }
            
            // –ß–î
            if (values.rr !== null) {
                usedParams++;
                if (values.rr > 49 || values.rr <= 5) score += 4;
                else if (values.rr >= 35 && values.rr <= 49) score += 3;
                else if (values.rr >= 6 && values.rr <= 9) score += 2;
                else if ((values.rr >= 25 && values.rr <= 34) || 
                         (values.rr >= 10 && values.rr <= 11)) score += 1;
            }
            
            // –ê–î —Å–∏—Å—Ç–æ–ª–∏—á–µ—Å–∫–æ–µ
            if (values.sbp !== null) {
                usedParams++;
                if (values.sbp < 70) score += 4;
                else if (values.sbp >= 70 && values.sbp <= 90) score += 2;
            }
            
            // SpO2
            if (values.spo2 !== null) {
                usedParams++;
                if (values.spo2 < 85) score += 4;
                else if (values.spo2 >= 85 && values.spo2 <= 89) score += 3;
                else if (values.spo2 >= 90 && values.spo2 <= 91) score += 1;
            }
            
            // –õ–µ–π–∫–æ—Ü–∏—Ç—ã
            if (values.wbc !== null) {
                usedParams++;
                if (values.wbc > 39.9 || values.wbc < 1) score += 4;
                else if ((values.wbc >= 25 && values.wbc <= 39.9) || 
                         (values.wbc >= 1 && values.wbc <= 2.9)) score += 2;
                else if ((values.wbc >= 17 && values.wbc <= 24.9) || 
                         (values.wbc >= 3 && values.wbc <= 5.6)) score += 1;
            }
            
            // –Æ–Ω—ã–µ –Ω–µ–π—Ç—Ä–æ—Ñ–∏–ª—ã
            if (values.bands !== null) {
                usedParams++;
                if (values.bands >= 10) score += 2;
            }
            
            // –õ–∞–∫—Ç–∞—Ç
            if (values.lactate !== null) {
                usedParams++;
                if (values.lactate >= 4) score += 2;
            }
            
            const risk = score >= 6 ? '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫' : '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫';
            const riskClass = score >= 6 ? 'high-risk' : 'low-risk';
            const interpretation = score >= 6 
                ? '–ü–æ–∫–∞–∑–∞–Ω–∞ –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤ –û–†–ò–¢'
                : '–†–∏—Å–∫ —Å–µ–ø—Å–∏—Å–∞ –Ω–∏–∑–∫–∏–π';
                
            return { 
                score, 
                usedParams, 
                totalParams: 8, 
                risk, 
                riskClass, 
                interpretation 
            };
        }

        function calculateQSOFA(values) {
            let score = 0;
            let usedParams = 0;
            
            if (values.sbp !== null) {
                usedParams++;
                if (values.sbp < 100) score++;
            }
            if (values.rr !== null) {
                usedParams++;
                if (values.rr > 22) score++;
            }
            if (values.gcs !== null) {
                usedParams++;
                if (values.gcs < 13) score++;
            }
            
            const risk = score >= 2 ? '–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫' : '–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫';
            const riskClass = score >= 2 ? 'high-risk' : 'low-risk';
            const interpretation = score >= 2 
                ? '–ü–æ–∫–∞–∑–∞–Ω–∞ –≥–æ—Å–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è –≤ –û–†–ò–¢'
                : '–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ';
                
            return { 
                score, 
                usedParams, 
                totalParams: 3, 
                risk, 
                riskClass, 
                interpretation 
            };
        }

        // –°–±—Ä–æ—Å –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        function resetAll() {
            parameters.forEach(param => {
                const element = document.getElementById(param.id);
                if (param.type === 'select') {
                    element.value = param.options[0].value;
                } else {
                    element.value = '';
                    element.classList.remove('critical', 'warning', 'normal');
                }
            });
            updateAllCalculations();
        }

        // PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
        function setupPWA() {
            // –ü–æ–∫–∞–∑ –±–∞–Ω–Ω–µ—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                setTimeout(() => {
                    pwaBanner.style.display = 'block';
                }, 3000);
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            }

            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js').catch(error => {
                    console.log('Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å:', error);
                });
            }
        }

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–∏–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ');
                    }
                    deferredPrompt = null;
                    pwaBanner.style.display = 'none';
                });
            }
        }

        function dismissBanner() {
            pwaBanner.style.display = 'none';
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('beforeunload', function() {
            const values = getInputValues();
            localStorage.setItem('sepsis_calculator_data', JSON.stringify(values));
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        window.addEventListener('load', function() {
            const saved = localStorage.getItem('sepsis_calculator_data');
            if (saved) {
                const values = JSON.parse(saved);
                parameters.forEach(param => {
                    const element = document.getElementById(param.id);
                    if (values[param.id] !== undefined) {
                        if (param.type === 'select') {
                            element.value = values[param.id];
                        } else {
                            element.value = values[param.id];
                        }
                    }
                });
                updateAllCalculations();
            }
        });
    </script>
</body>
</html>
